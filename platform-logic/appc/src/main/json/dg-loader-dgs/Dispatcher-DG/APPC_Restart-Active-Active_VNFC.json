[{"id":"cd34f9f0.1d9868","type":"dgstart","name":"DGSTART","outputs":1,"x":127.28811645507812,"y":20.999963760375977,"z":"ae41b0e9.09ae2","wires":[["f6b6354f.0ddf38"]]},{"id":"f6b6354f.0ddf38","type":"service-logic","name":"APPC 2.0.0","module":"APPC","version":"2.0.0","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='APPC' version='2.0.0'>","outputs":1,"x":132.28817749023438,"y":70.56663703918457,"z":"ae41b0e9.09ae2","wires":[["8c403f40.821b5"]]},{"id":"8c403f40.821b5","type":"method","name":"Restart-Active-Active_VNFC","xml":"<method rpc='Restart-Active-Active_VNFC' mode='sync'>\n","comments":"","outputs":1,"x":387.03822326660156,"y":71.81661415100098,"z":"ae41b0e9.09ae2","wires":[["ed7c3c6d.a984c"]]},{"id":"45276a62.7c92c4","type":"for","name":"for_each_vm","xml":"<for index=\"vmIndex\" start=\"0\" end=\"`$vmCount`\" >","comments":"","outputs":1,"x":480.28807067871094,"y":455.0000247955322,"z":"ae41b0e9.09ae2","wires":[["b0f68ecc.113e"]]},{"id":"ed7c3c6d.a984c","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"false","comments":"","outputs":1,"x":75.5,"y":222.75000190734863,"z":"ae41b0e9.09ae2","wires":[["5b372d0b.047e04","f72d65c7.04b878","860a3ff7.f7ce8","2e70b639.278d4a","ce24660a.70bd38"]]},{"id":"3fc5910d.6ff2ae","type":"for","name":"for_each_vm","xml":"<for index=\"vmIndex\" start=\"0\" end=\"`$vmCount`\" >","comments":"","outputs":1,"x":468.3783874511719,"y":719.5356998443604,"z":"ae41b0e9.09ae2","wires":[["793be6bd.8ef148"]]},{"id":"74b788b3.2be2f8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1629.9331359863281,"y":707.9285507202148,"z":"ae41b0e9.09ae2","wires":[["aed13d59.d33b6"]]},{"id":"e546a2e8.8d275","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n","comments":"","x":804.8614959716797,"y":1335.7500252723694,"z":"ae41b0e9.09ae2","wires":[]},{"id":"b8f2e995.5da048","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n","comments":"","x":805.0924224853516,"y":1275.1499276161194,"z":"ae41b0e9.09ae2","wires":[]},{"id":"5b372d0b.047e04","type":"switchNode","name":"switch_server_restart_success","xml":"<switch test='`$restartFailedCount == 0 and $restartSkippedCount == 0 and $healthCheckFailedCount == 0`'>\n","comments":"","outputs":1,"x":371.34271240234375,"y":1302.4832401275635,"z":"ae41b0e9.09ae2","wires":[["a64987ff.3681c8","369d7bad.6115d4"]]},{"id":"a64987ff.3681c8","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":594.5927124023438,"y":1335.2332711219788,"z":"ae41b0e9.09ae2","wires":[["e546a2e8.8d275"]]},{"id":"369d7bad.6115d4","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":596.0927429199219,"y":1275.233332157135,"z":"ae41b0e9.09ae2","wires":[["b8f2e995.5da048"]]},{"id":"c833ddce.53e9a","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1556.2881164550781,"y":796.9999618530273,"z":"ae41b0e9.09ae2","wires":[["3c5daadb.8b49d6"]]},{"id":"c78696a0.1c9918","type":"set","name":"set_mark_vm_failed","xml":"<set>\n<parameter name=\"restartFailedCount\" value=\"`$restartFailedCount + 1`\" />\n","comments":"","x":2186.7174072265625,"y":618.7618103027344,"z":"ae41b0e9.09ae2","wires":[]},{"id":"2d7e5cc9.758c64","type":"record","name":"Log event","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"level\" value=\"error\"/>\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"record\" value=\"`$event-message`\"/>\n","comments":"","outputs":1,"x":2156.717803955078,"y":684.7618637084961,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"a1fe0884.e414e8","type":"execute","name":"OutputMessageBuilder","xml":"<execute plugin='org.openecomp.appc.dg.common.OutputMessagePlugin' method='outputMessageBuilder' >\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n<parameter name=\"event-message\" value=\"`$event-message`\" />","comments":"","outputs":1,"x":2183.584560394287,"y":727.9492416381836,"z":"ae41b0e9.09ae2","wires":[["de56e9e1.0fb738"]]},{"id":"4019eb71.f46704","type":"record","name":"Log message","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"level\" value=\"debug\"/>\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"record\" value=\"Attempting to restart DOWN servers\"/>\n","comments":"","outputs":1,"x":497.2881317138672,"y":385.6665897369385,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"ccd05e9a.19417","type":"record","name":"Log message","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"level\" value=\"debug\"/>\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"record\" value=\"Attempting to restart UP servers\"/>\n","comments":"","outputs":1,"x":471.28812408447266,"y":662.9166669845581,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"4dbab17.c93485","type":"comment","name":"Restart Up servers","info":"","comments":"","x":319.2881164550781,"y":618.6666507720947,"z":"ae41b0e9.09ae2","wires":[]},{"id":"45176027.28e49","type":"comment","name":"Restart Down servers","info":"","comments":"","x":311.0381164550781,"y":322.1666202545166,"z":"ae41b0e9.09ae2","wires":[]},{"id":"aed13d59.d33b6","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1846.7168273925781,"y":706.8571395874023,"z":"ae41b0e9.09ae2","wires":[["c78696a0.1c9918","2d7e5cc9.758c64","a1fe0884.e414e8"]]},{"id":"f7834d15.217b6","type":"comment","name":"Update VNFC restart status","info":"","comments":"","x":376.5739440917969,"y":1248.0000247955322,"z":"ae41b0e9.09ae2","wires":[]},{"id":"b0f68ecc.113e","type":"switchNode","name":"switch : healthcheck status","xml":"<switch test=\"`$vm[$vmIndex].status`\">\n","comments":"","outputs":1,"x":707.2881698608398,"y":457.99996185302734,"z":"ae41b0e9.09ae2","wires":[["d743b216.3511","a6315d8d.44126","3bfcb24a.fa473e"]]},{"id":"d743b216.3511","type":"other","name":"outcome_down","xml":"<outcome value='DOWN'>\n","comments":"","outputs":1,"x":975.5737915039062,"y":585.7142581939697,"z":"ae41b0e9.09ae2","wires":[["8ff4886b.b72338"]]},{"id":"7e312494.69dbec","type":"set","name":"set_mark_vm_restarted","xml":"<set>\n<parameter name=\"restartedServerList[$restartSuccessCount].url\" value=\"`$vm[$vmIndex].url`\" />\n","comments":"","x":1987.4308776855469,"y":766.1429386138916,"z":"ae41b0e9.09ae2","wires":[]},{"id":"72be6190.108dc","type":"set","name":"init","xml":"<set>\n<parameter name='restartFailedCount' value='0' />\n<parameter name='restartSkippedCount' value='0' />\n<parameter name='restartSuccessCount' value='0' />\n","comments":"","x":459.14527893066406,"y":342.2856693267822,"z":"ae41b0e9.09ae2","wires":[]},{"id":"ff29c3ed.900ee","type":"comment","name":"Health check restarted servers","info":"","comments":"","x":342.2881164550781,"y":819.999963760376,"z":"ae41b0e9.09ae2","wires":[]},{"id":"4b594278.ba7cac","type":"record","name":"Log message","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"level\" value=\"debug\"/>\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"record\" value=\"`'Restart succeeded for the server : ' + $vm[$vmIndex].url`\"/>\n","comments":"","outputs":1,"x":1961.4308776855469,"y":854.1428775787354,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"3c5daadb.8b49d6","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1734.4309387207031,"y":799.1429080963135,"z":"ae41b0e9.09ae2","wires":[["4b594278.ba7cac","7e312494.69dbec","3908f3bc.3be64c"]]},{"id":"a6315d8d.44126","type":"other","name":"outcome_unknown","xml":"<outcome value='UNKNOWN'>\n","comments":"","outputs":1,"x":986.6428833007812,"y":522.2856693267822,"z":"ae41b0e9.09ae2","wires":[["8ff4886b.b72338"]]},{"id":"ba04eada.28e368","type":"record","name":"Log message","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"level\" value=\"debug\"/>\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"record\" value=\"`'Attempting to restart the server : ' + $vm[$vmIndex].url`\"/>\n","comments":"","outputs":1,"x":1387.0715637207031,"y":531.5713729858398,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"8ff4886b.b72338","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1183.642822265625,"y":588.8570804595947,"z":"ae41b0e9.09ae2","wires":[["ba04eada.28e368","5a80da73.594524","239f297a.71d536"]]},{"id":"f72d65c7.04b878","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":301.5,"y":234.00002479553223,"z":"ae41b0e9.09ae2","wires":[["8f74d90e.2b6ca8","5bf4a4d7.86b44c","e5c61a50.5fd478","628f7207.6b94dc"]]},{"id":"8f74d90e.2b6ca8","type":"for","name":"for_each_vm","xml":"<for index=\"i\" start=\"0\" end=\"`$vmCount`\" >","comments":"","outputs":1,"x":658.5,"y":214.00002479553223,"z":"ae41b0e9.09ae2","wires":[["c2e18a4b.2976a8"]]},{"id":"c2e18a4b.2976a8","type":"set","name":"set : health check input list","xml":"<set>\n<parameter name=\"healthcheck.vm[$i].url\" value=\"`$vm[$i].url`\" />\n","comments":"","x":877.5000610351562,"y":213.99996376037598,"z":"ae41b0e9.09ae2","wires":[]},{"id":"5bf4a4d7.86b44c","type":"call","name":"call_vnfc_healthcheck_dg","xml":"<call rpc='`$HealthCheckDG.dg_name`' version='`$HealthCheckDG.dg_version`' module='`$HealthCheckDG.dg_module`' mode='sync' >\n","comments":"","outputs":1,"x":693.8046875,"y":319.2333011627197,"z":"ae41b0e9.09ae2","wires":[["4139fead.003ea","f72b1721.a74a38","f4cc1b80.ecfd88"]]},{"id":"793be6bd.8ef148","type":"switchNode","name":"switch : healthcheck status","xml":"<switch test=\"`$vm[$vmIndex].status`\">\n","comments":"","outputs":1,"x":703.5,"y":718.9999713897705,"z":"ae41b0e9.09ae2","wires":[["ab80f920.4408b8"]]},{"id":"ab80f920.4408b8","type":"other","name":"outcome_up","xml":"<outcome value='UP'>\n","comments":"","outputs":1,"x":958.0716552734375,"y":719.2856693267822,"z":"ae41b0e9.09ae2","wires":[["8ff4886b.b72338"]]},{"id":"2318f81f.7133f8","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":699.5,"y":948.999963760376,"z":"ae41b0e9.09ae2","wires":[["7cccdfff.d92d3","80621325.2ca61","f5a17c54.48543","248ea7ff.fe9d18"]]},{"id":"7cccdfff.d92d3","type":"for","name":"for_each_vm","xml":"<for index=\"i\" start=\"0\" end=\"`$restartSuccessCount`\" >","comments":"","outputs":1,"x":906.5,"y":926.999963760376,"z":"ae41b0e9.09ae2","wires":[["68eeb3e8.99f9ac"]]},{"id":"68eeb3e8.99f9ac","type":"set","name":"set : health check input list","xml":"<set>\n<parameter name=\"healthcheck.vm[$i].url\" value=\"`$restartedServerList[$i].url`\" />\n","comments":"","x":1126.9444999694824,"y":927.1109943389893,"z":"ae41b0e9.09ae2","wires":[]},{"id":"80621325.2ca61","type":"call","name":"call_vnfc_healthcheck_dg","xml":"<call rpc='`$HealthCheckDG.dg_name`' version='`$HealthCheckDG.dg_version`' module='`$HealthCheckDG.dg_module`' mode='sync' >\n","comments":"","outputs":1,"x":947.8046875,"y":1025.2332401275635,"z":"ae41b0e9.09ae2","wires":[["ad8e8d3.979a07","4d6bfe7.14324","30227c5f.41a2b4"]]},{"id":"f5a17c54.48543","type":"set","name":"set","xml":"<set>\n<parameter name=\"healthcheck.vmCount\" value=\"`$restartSuccessCount`\" />\n<parameter name=\"retry-healthcheck\" value=\"true\"/>\n","comments":"","x":887.5,"y":975.999963760376,"z":"ae41b0e9.09ae2","wires":[]},{"id":"ad8e8d3.979a07","type":"outcome","name":"healthcheck_failed","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1211.5,"y":985.9999961853027,"z":"ae41b0e9.09ae2","wires":[["bead2929.f122e8"]]},{"id":"4d6bfe7.14324","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1183.0164947509766,"y":1038.3381748199463,"z":"ae41b0e9.09ae2","wires":[["67509b2d.7a3494"]]},{"id":"30227c5f.41a2b4","type":"outcome","name":"healthcheck_success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1220.75,"y":1148.5000247955322,"z":"ae41b0e9.09ae2","wires":[["ccdf433.6eb21c"]]},{"id":"ccdf433.6eb21c","type":"for","name":"for_each_vm","xml":"<for index=\"i\" start=\"0\" end=\"`$restartSuccessCount`\" >","comments":"","outputs":1,"x":1022.5,"y":1240.999963760376,"z":"ae41b0e9.09ae2","wires":[["61a58ac8.9830e4"]]},{"id":"61a58ac8.9830e4","type":"switchNode","name":"switch : healthcheck status","xml":"<switch test=\"`$healthcheck.vm[$i].status`\">\n","comments":"","outputs":1,"x":1232.5,"y":1278.999963760376,"z":"ae41b0e9.09ae2","wires":[["7e3e3230.6dba1c","db1f7fae.3cb2f","bf70ffe6.d3a17"]]},{"id":"7e3e3230.6dba1c","type":"other","name":"outcome_up","xml":"<outcome value='UP'>\n","comments":"","outputs":1,"x":1474.5000305175781,"y":1324.9999985694885,"z":"ae41b0e9.09ae2","wires":[["1652d018.e2aee"]]},{"id":"1652d018.e2aee","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1737.5,"y":1425.999963760376,"z":"ae41b0e9.09ae2","wires":[["1c064d7.3edc6b3","ba547465.f89908","8add556a.b92a78"]]},{"id":"1c064d7.3edc6b3","type":"execute","name":"Report_Success","xml":"<execute plugin='org.openecomp.appc.dg.common.DCAEReporterPlugin' method='reportSuccess' >\n<parameter name=\"event-message\" value=\"`$success-message`\"/>","comments":"","outputs":1,"x":1994.5001068115234,"y":1533.5714511871338,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"ba547465.f89908","type":"record","name":"Log message","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"level\" value=\"debug\"/>\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"record\" value=\"`$success-message`\"/>\n","comments":"","outputs":1,"x":1983.5548553466797,"y":1476.0666618347168,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"8add556a.b92a78","type":"set","name":"Set success message","xml":"<set>\n<parameter name='success-message' value=\"`'Restart succeeded for the server : ' + $restartedServerList[$i].url`\"/>\n<parameter name=\"RestartSuccessVMCount\" value=\"`$RestartSuccessVMCount + 1`\" />\n\n","comments":"","x":2006.5548553466797,"y":1426.0666618347168,"z":"ae41b0e9.09ae2","wires":[]},{"id":"bf70ffe6.d3a17","type":"other","name":"outcome_down","xml":"<outcome value='DOWN'>\n","comments":"","outputs":1,"x":1484.5000305175781,"y":1232.9999985694885,"z":"ae41b0e9.09ae2","wires":[["22071ff1.487f5"]]},{"id":"db1f7fae.3cb2f","type":"other","name":"outcome_unknown","xml":"<outcome value='UNKNOWN'>\n","comments":"","outputs":1,"x":1495.283447265625,"y":1279.142786026001,"z":"ae41b0e9.09ae2","wires":[["22071ff1.487f5"]]},{"id":"22071ff1.487f5","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1731.21435546875,"y":1218.285608291626,"z":"ae41b0e9.09ae2","wires":[["d4d99d29.7a253","92aa83bf.6feed","f7e19e76.fbb7c","edeab88e.243dd8"]]},{"id":"d4d99d29.7a253","type":"set","name":"Set event message","xml":"<set>\n<parameter name='event-message' value=\"`'Health check failed for the restarted server : ' + $restartedServerList[$i].url`\"/>\n","comments":"","x":1993.2144012451172,"y":1218.2856559753418,"z":"ae41b0e9.09ae2","wires":[]},{"id":"92aa83bf.6feed","type":"set","name":"increment healthCheck failed VM count","xml":"<set>\n<parameter name=\"healthCheckFailedCount\" value=\"`$healthCheckFailedCount + 1`\" />\n","comments":"","x":2061.214401245117,"y":1267.2856559753418,"z":"ae41b0e9.09ae2","wires":[]},{"id":"f7e19e76.fbb7c","type":"record","name":"Log event","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"level\" value=\"error\"/>\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"record\" value=\"`$event-message`\"/>\n","comments":"","outputs":1,"x":1968.1606903076172,"y":1315.8857536315918,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"edeab88e.243dd8","type":"execute","name":"OutputMessageBuilder","xml":"<execute plugin='org.openecomp.appc.dg.common.OutputMessagePlugin' method='outputMessageBuilder' >\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n<parameter name=\"event-message\" value=\"`$event-message`\" />","comments":"","outputs":1,"x":2009.0274658203125,"y":1364.0730838775635,"z":"ae41b0e9.09ae2","wires":[["de56e9e1.0fb738"]]},{"id":"146acfc4.db634","type":"set","name":"init","xml":"<set>\n<parameter name='healthCheckFailedCount' value='0' />\n","comments":"","x":468.5000305175781,"y":867.999963760376,"z":"ae41b0e9.09ae2","wires":[]},{"id":"248ea7ff.fe9d18","type":"record","name":"Log message","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"level\" value=\"debug\"/>\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"record\" value=\"Attempting to health check the restarted servers of the VNFC\"/>\n","comments":"","outputs":1,"x":909.4097290039062,"y":878.3809452056885,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"3bfcb24a.fa473e","type":"other","name":"outcome_failure","xml":"<outcome value='FAILURE'>\n","comments":"","outputs":1,"x":982.5,"y":457.999963760376,"z":"ae41b0e9.09ae2","wires":[["afe6d608.6433a8"]]},{"id":"f2029c3c.86a2f","type":"set","name":"Set event message","xml":"<set>\n<parameter name='event-message' value=\"`'Error occurred during pre-health check : ' + $vm[$vmIndex].url + '. Hence skipping its restart.'`\"/>","comments":"","x":1763.5,"y":370.9999942779541,"z":"ae41b0e9.09ae2","wires":[]},{"id":"afe6d608.6433a8","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1373.833251953125,"y":456.9999942779541,"z":"ae41b0e9.09ae2","wires":[["f2029c3c.86a2f","bc689a04.21c6e8","77824ab1.d42474","c92c539c.fc047"]]},{"id":"bc689a04.21c6e8","type":"set","name":"set_mark_vm_skipped","xml":"<set>\n<parameter name=\"restartSkippedCount\" value=\"`$restartSkippedCount + 1`\" />\n","comments":"","x":1777.5,"y":417.9999942779541,"z":"ae41b0e9.09ae2","wires":[]},{"id":"4139fead.003ea","type":"outcome","name":"healthcheck_failed","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1052.5,"y":340.999963760376,"z":"ae41b0e9.09ae2","wires":[["d5d15505.317458"]]},{"id":"f72b1721.a74a38","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1031.0164794921875,"y":395.3381290435791,"z":"ae41b0e9.09ae2","wires":[["8a1531f1.c2158"]]},{"id":"f4cc1b80.ecfd88","type":"outcome","name":"healthcheck_success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1048.97216796875,"y":277.5000247955322,"z":"ae41b0e9.09ae2","wires":[["4c08ade6.fe4dd4"]]},{"id":"e5c61a50.5fd478","type":"set","name":"set","xml":"<set>\n<parameter name=\"healthcheck.vmCount\" value=\"`$vmCount`\" />\n<parameter name=\"retry-healthcheck\" value=\"false\"/>\n","comments":"","x":643.5,"y":262.999963760376,"z":"ae41b0e9.09ae2","wires":[]},{"id":"67509b2d.7a3494","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1429.5,"y":1038.999963760376,"z":"ae41b0e9.09ae2","wires":[["cbd3bc29.1cecd","15a249d1.cb3bc6","8fd2ec2e.de8f1","cfc2f0d9.4cf62"]]},{"id":"cfc2f0d9.4cf62","type":"set","name":"Set event message","xml":"<set>\n<parameter name='event-message' value=\"VNFC Health check DG not found\"/>","comments":"","x":1704.166748046875,"y":1039.999948501587,"z":"ae41b0e9.09ae2","wires":[]},{"id":"8fd2ec2e.de8f1","type":"record","name":"Log error","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"level\" value=\"error\"/>\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"record\" value=\"`$error-message`\"/>\n","comments":"","outputs":1,"x":1675.6329345703125,"y":1085.8125858306885,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"cbd3bc29.1cecd","type":"execute","name":"OutputMessageBuilder","xml":"<execute plugin='org.openecomp.appc.dg.common.OutputMessagePlugin' method='outputMessageBuilder' >\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n<parameter name=\"event-message\" value=\"`$event-message`\" />","comments":"","outputs":1,"x":1714.5001525878906,"y":1129.999963760376,"z":"ae41b0e9.09ae2","wires":[["de56e9e1.0fb738"]]},{"id":"15a249d1.cb3bc6","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n","comments":"","x":1684.2607421875,"y":1175.187952041626,"z":"ae41b0e9.09ae2","wires":[]},{"id":"bead2929.f122e8","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1433.5,"y":985.999963760376,"z":"ae41b0e9.09ae2","wires":[["207fed09.9a8492","8fd2ec2e.de8f1","cbd3bc29.1cecd","15a249d1.cb3bc6"]]},{"id":"207fed09.9a8492","type":"set","name":"Set event message","xml":"<set>\n<parameter name='event-message' value=\"Error occurred during post-health check of the restarted servers\"/>","comments":"","x":1700.5,"y":984.999963760376,"z":"ae41b0e9.09ae2","wires":[]},{"id":"d5d15505.317458","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1397.5,"y":344.999963760376,"z":"ae41b0e9.09ae2","wires":[["2c8c1b1d.016d24","77824ab1.d42474","c92c539c.fc047","428cb220.cb137c"]]},{"id":"8a1531f1.c2158","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1387.5,"y":400.999963760376,"z":"ae41b0e9.09ae2","wires":[["c92c539c.fc047","428cb220.cb137c","77824ab1.d42474","fd9d4346.08f21"]]},{"id":"2c8c1b1d.016d24","type":"set","name":"Set event message","xml":"<set>\n<parameter name='event-message' value=\"Error occurred during pre-health check\"/>","comments":"","x":1756.5,"y":269.999963760376,"z":"ae41b0e9.09ae2","wires":[]},{"id":"fd9d4346.08f21","type":"set","name":"Set event message","xml":"<set>\n<parameter name='event-message' value=\"VNFC Health check DG not found\"/>","comments":"","x":1760.166748046875,"y":321.9999485015869,"z":"ae41b0e9.09ae2","wires":[]},{"id":"77824ab1.d42474","type":"record","name":"Log event","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"level\" value=\"error\"/>\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"record\" value=\"`$event-message`\"/>\n","comments":"","outputs":1,"x":1734.6329345703125,"y":462.8125858306885,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"c92c539c.fc047","type":"execute","name":"OutputMessageBuilder","xml":"<execute plugin='org.openecomp.appc.dg.common.OutputMessagePlugin' method='outputMessageBuilder' >\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n<parameter name=\"event-message\" value=\"`$event-message`\" />","comments":"","outputs":1,"x":1771.5001220703125,"y":510.999963760376,"z":"ae41b0e9.09ae2","wires":[["de56e9e1.0fb738"]]},{"id":"428cb220.cb137c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n","comments":"","x":1746.2607421875,"y":559.187952041626,"z":"ae41b0e9.09ae2","wires":[]},{"id":"860a3ff7.f7ce8","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":296.5,"y":360.999963760376,"z":"ae41b0e9.09ae2","wires":[["72be6190.108dc","4019eb71.f46704","45276a62.7c92c4"]]},{"id":"2e70b639.278d4a","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":303.5,"y":662.999963760376,"z":"ae41b0e9.09ae2","wires":[["ccd05e9a.19417","3fc5910d.6ff2ae"]]},{"id":"8c13cfcc.6b30e","type":"comment","name":"Health check servers","info":"","comments":"","x":340.5000305175781,"y":194.99996376037598,"z":"ae41b0e9.09ae2","wires":[]},{"id":"628f7207.6b94dc","type":"record","name":"Log message","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"level\" value=\"debug\"/>\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"record\" value=\"Attempting to health check the servers of the VNFC before restarting them.\"/>\n","comments":"","outputs":1,"x":665.611083984375,"y":160.88884925842285,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"3908f3bc.3be64c","type":"set","name":"increment_restarted_vm_count","xml":"<set>\n<parameter name='restartSuccessCount' value='`$restartSuccessCount+1`' />\n","comments":"","x":2014.1769714355469,"y":812.7777652740479,"z":"ae41b0e9.09ae2","wires":[]},{"id":"76ce77bd.4cacc8","type":"switchNode","name":"switch : restarted server > 0","xml":"<switch test='`$restartSuccessCount > 0`'>\n","comments":"","outputs":1,"x":347.2881164550781,"y":948.999963760376,"z":"ae41b0e9.09ae2","wires":[["9cfcf21e.faba1","c7044ad3.bc0ca8"]]},{"id":"c7044ad3.bc0ca8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":544.0381469726562,"y":948.7500858306885,"z":"ae41b0e9.09ae2","wires":[["2318f81f.7133f8"]]},{"id":"9cfcf21e.faba1","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":542.5381164550781,"y":998.7500247955322,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"ce24660a.70bd38","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":304.2881164550781,"y":867.999963760376,"z":"ae41b0e9.09ae2","wires":[["76ce77bd.4cacc8","146acfc4.db634"]]},{"id":"5a80da73.594524","type":"call","name":"Restart","xml":"<call module='APPC' rpc='Restart_VM' mode='sync' >\n","comments":"","outputs":1,"x":1370.7325744628906,"y":655.999963760376,"z":"ae41b0e9.09ae2","wires":[["74b788b3.2be2f8","c833ddce.53e9a","f8a530a5.dc002"]]},{"id":"239f297a.71d536","type":"set","name":"set restart parameters","xml":"<set>\n<parameter name=\"restart-vm-url\" value=\"`$vm[$vmIndex].url`\" />\n<parameter name=\"application-node-name\" value=\"`$vm[$vmIndex].node-name`\" />\n<parameter name=\"application-status\" value=\"`$vm[$vmIndex].status`\" />\n<parameter name='restartRetryCount' value='3'/>\n","comments":"","x":1416.7325744628906,"y":590.0000247955322,"z":"ae41b0e9.09ae2","wires":[]},{"id":"f8a530a5.dc002","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1618.0659484863281,"y":636.9999618530273,"z":"ae41b0e9.09ae2","wires":[["a7ed0995.4f2518"]]},{"id":"a7ed0995.4f2518","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1837.0659484863281,"y":636.9999618530273,"z":"ae41b0e9.09ae2","wires":[["78403997.4e6fc8","c78696a0.1c9918","2d7e5cc9.758c64","a1fe0884.e414e8"]]},{"id":"78403997.4e6fc8","type":"set","name":"Set event message","xml":"<set>\n<parameter name='event-message' value=\"`'DG to execute Restart action not found for VM: ' + $vm[$vmIndex].url`\"/>\n","comments":"","x":2131.637237548828,"y":515.7141952514648,"z":"ae41b0e9.09ae2","wires":[]},{"id":"de56e9e1.0fb738","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2612.803741455078,"y":967.515588760376,"z":"ae41b0e9.09ae2","wires":[["3a327862.942808"]]},{"id":"3a327862.942808","type":"execute","name":"Report_Error_To_DCAE","xml":"<execute plugin='org.openecomp.appc.dg.common.DCAEReporterPlugin' method='report' >\n<parameter name=\"event-message\" value=\"`$event-message`\" />","comments":"","outputs":1,"x":3142.303741455078,"y":958.515588760376,"z":"ae41b0e9.09ae2","wires":[["d990af07.e6417"]]},{"id":"d990af07.e6417","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":3396.589141845703,"y":965.944299697876,"z":"ae41b0e9.09ae2","wires":[[]]},{"id":"4c08ade6.fe4dd4","type":"for","name":"for_each_vm","xml":"<for index=\"i\" start=\"0\" end=\"`$vmCount`\" >","comments":"","outputs":1,"x":1261.8436279296875,"y":278.88884925842285,"z":"ae41b0e9.09ae2","wires":[["5866543a.6d051c"]]},{"id":"5866543a.6d051c","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1456.544921875,"y":278.24883460998535,"z":"ae41b0e9.09ae2","wires":[["5cdd015c.a3958"]]},{"id":"5cdd015c.a3958","type":"set","name":"set VM params","xml":"<set>\n<parameter name=\"vm[$i].status\" value=\"`$healthcheck.vm[$i].status`\" />\n<parameter name=\"vm[$i].node-name\" value=\"`$healthcheck.vm[$i].nodeName`\" />\n","comments":"","x":1697.544921875,"y":199.24883460998535,"z":"ae41b0e9.09ae2","wires":[]}]
